# 테스트 체크리스트

## 테스트 환경

| 항목 | 버전 |
|------|------|
| OS | Windows 10 |
| Browser | Chrome |
| Java | 23 |
| Node.js | 22 |

## 자동화 테스트

### JUnit 테스트 (총 49개)
```bash
cd backend
mvnw.cmd test
```

| 테스트 클래스 | 테스트 수 | 설명 |
|--------------|----------|------|
| ExtensionServiceTest | 31 | 서비스 단위 테스트 |
| ExtensionControllerTest | 14 | API 통합 테스트 |
| ExtensionServiceConcurrencyTest | 4 | 동시성 테스트 |

### Postman API 테스트 (35개 이상)
`postman_collection.json` 파일을 Postman에 import하여 실행

---

## 1. 기능 테스트

### 1.1 고정 확장자
| # | 테스트 항목 | 예상 결과 | 통과 |
|---|------------|----------|------|
| 1 | 페이지 로드 시 7개 확장자 표시 | bat, cmd, com, cpl, exe, scr, js 모두 표시 | [ ] |
| 2 | 초기 상태 확인 | 모든 체크박스 해제 상태 | [ ] |
| 3 | 체크박스 클릭 | 활성화 토글 동작 | [ ] |
| 4 | 새로고침 후 상태 유지 | 체크 상태 그대로 유지 | [ ] |
| 5 | 서버 재시작 후 상태 유지 | 체크 상태 그대로 유지 | [ ] |

### 1.2 커스텀 확장자 추가
| # | 테스트 항목 | 입력값 | 예상 결과 | 통과 |
|---|------------|-------|----------|------|
| 1 | 정상 추가 | `sh` | 태그 영역에 표시 | [ ] |
| 2 | 정상 추가 | `py` | 태그 영역에 표시 | [ ] |
| 3 | Enter 키로 추가 | `php` + Enter | 추가됨 | [ ] |
| 4 | 버튼 클릭으로 추가 | `rb` + 버튼 클릭 | 추가됨 | [ ] |
| 5 | 개수 카운터 증가 | 추가 후 | n/200 증가 | [ ] |

### 1.3 커스텀 확장자 삭제
| # | 테스트 항목 | 예상 결과 | 통과 |
|---|------------|----------|------|
| 1 | X 버튼 클릭 | 해당 태그 삭제 | [ ] |
| 2 | 개수 카운터 감소 | n/200 감소 | [ ] |
| 3 | 새로고침 후 삭제 상태 유지 | 삭제된 상태 유지 | [ ] |

---

## 2. 입력값 검증 테스트

### 2.1 정규화 (자동 변환)
| # | 입력값 | 예상 결과 | 통과 |
|---|-------|----------|------|
| 1 | `SH` | `sh`로 저장 | [ ] |
| 2 | `Py` | `py`로 저장 | [ ] |
| 3 | `  sh  ` | `sh`로 저장 (공백 제거) | [ ] |
| 4 | `.exe` | `exe`로 저장 (점 제거) | [ ] |
| 5 | `.txt` | `txt`로 저장 | [ ] |

### 2.2 거부 케이스
| # | 입력값 | 예상 에러 메시지 | 통과 |
|---|-------|----------------|------|
| 1 | (빈 문자열) | "확장자를 입력해주세요." | [ ] |
| 2 | `   ` (공백만) | "확장자를 입력해주세요." | [ ] |
| 3 | `abcdefghijklmnopqrstu` (21자) | "확장자는 최대 20자까지 입력 가능합니다." | [ ] |
| 4 | `sh!` | "유효하지 않은 확장자입니다." | [ ] |
| 5 | `py@` | "유효하지 않은 확장자입니다." | [ ] |
| 6 | `a/b` | "경로 문자는 사용할 수 없습니다." | [ ] |
| 7 | `a\b` | "경로 문자는 사용할 수 없습니다." | [ ] |
| 8 | `../sh` | "경로 문자는 사용할 수 없습니다." | [ ] |
| 9 | `한글` | "유효하지 않은 확장자입니다." | [ ] |
| 10 | `te st` (중간 공백) | "유효하지 않은 확장자입니다." | [ ] |
| 11 | `exe` (고정 확장자) | "이미 등록된 확장자입니다." | [ ] |
| 12 | `js` (고정 확장자) | "이미 등록된 확장자입니다." | [ ] |
| 13 | `sh` (이미 추가된 커스텀) | "이미 등록된 확장자입니다." | [ ] |

### 2.3 경계값 테스트
| # | 입력값 | 예상 결과 | 통과 |
|---|-------|----------|------|
| 1 | `a` (1자) | 정상 추가 | [ ] |
| 2 | `abcdefghijklmnopqrst` (20자) | 정상 추가 | [ ] |
| 3 | `12345` (숫자만) | 정상 추가 | [ ] |
| 4 | `a1b2c3` (영숫자 혼합) | 정상 추가 | [ ] |

---

## 3. 개수 제한 테스트

| # | 테스트 항목 | 예상 결과 | 통과 |
|---|------------|----------|------|
| 1 | 200개 등록 후 추가 시도 | "커스텀 확장자는 최대 200개까지 등록할 수 있습니다." | [ ] |
| 2 | 200개 상태에서 1개 삭제 후 추가 | 정상 추가 | [ ] |

---

## 4. UI/UX 테스트

### 4.1 로딩 상태
| # | 테스트 항목 | 예상 결과 | 통과 |
|---|------------|----------|------|
| 1 | API 호출 중 추가 버튼 | 비활성화 | [ ] |
| 2 | API 호출 중 체크박스 | 비활성화 | [ ] |
| 3 | API 호출 중 삭제 버튼 | 비활성화 | [ ] |
| 4 | 초기 로딩 시 | "데이터를 불러오는 중..." 표시 | [ ] |

### 4.2 에러 표시
| # | 테스트 항목 | 예상 결과 | 통과 |
|---|------------|----------|------|
| 1 | 유효하지 않은 입력 | 에러 메시지 표시 | [ ] |
| 2 | 입력 필드 수정 시 | 에러 메시지 사라짐 | [ ] |
| 3 | 성공 후 | 에러 메시지 없음 | [ ] |

### 4.3 레이아웃
| # | 테스트 항목 | 예상 결과 | 통과 |
|---|------------|----------|------|
| 1 | 데스크톱 (1920px) | 정상 표시 | [ ] |
| 2 | 태블릿 (768px) | 반응형 정상 | [ ] |
| 3 | 모바일 (375px) | 반응형 정상 | [ ] |

---

## 5. API 테스트 (Backend)

### 5.1 GET /api/extensions
| # | 테스트 항목 | 예상 결과 | 통과 |
|---|------------|----------|------|
| 1 | 정상 호출 | 200 OK + 확장자 목록 | [ ] |
| 2 | 응답 구조 확인 | fixedExtensions, customExtensions, customCount, maxCustomCount | [ ] |

### 5.2 PATCH /api/extensions/fixed/{extension}
| # | 테스트 항목 | 예상 결과 | 통과 |
|---|------------|----------|------|
| 1 | 존재하는 고정 확장자 | 200 OK | [ ] |
| 2 | 존재하지 않는 확장자 | 400 Bad Request | [ ] |

### 5.3 POST /api/extensions/custom
| # | 테스트 항목 | Body | 예상 결과 | 통과 |
|---|------------|------|----------|------|
| 1 | 정상 추가 | `{"extension": "sh"}` | 200 OK | [ ] |
| 2 | 중복 추가 | `{"extension": "sh"}` | 400 Bad Request | [ ] |
| 3 | 빈 값 | `{"extension": ""}` | 400 Bad Request | [ ] |
| 4 | null | `{}` | 400 Bad Request | [ ] |

### 5.4 DELETE /api/extensions/custom/{extension}
| # | 테스트 항목 | 예상 결과 | 통과 |
|---|------------|----------|------|
| 1 | 존재하는 커스텀 확장자 | 200 OK | [ ] |
| 2 | 존재하지 않는 확장자 | 400 Bad Request | [ ] |
| 3 | 고정 확장자 삭제 시도 | 400 Bad Request | [ ] |

---

## 6. 보안 테스트

| # | 테스트 항목 | 입력값 | 예상 결과 | 통과 |
|---|------------|-------|----------|------|
| 1 | XSS 스크립트 | `<img onerror=1>` | 거부 (특수문자) | [ ] |
| 2 | SQL Injection | `x' OR '1'='1` | 거부 (특수문자) | [ ] |
| 3 | Path Traversal | `a/b` | 거부 (경로 문자) | [ ] |
| 4 | Path Traversal | `a\\b` | 거부 (경로 문자) | [ ] |
| 5 | Path Traversal | `../etc` | 거부 (경로 문자) | [ ] |

> **참고**: 보안 테스트 입력값은 20자 제한 내에서 테스트하도록 단축되었습니다.
> 영숫자만 허용하므로 특수문자가 포함된 모든 공격은 `INVALID_EXTENSION` 에러로 차단됩니다.

---

## 7. 동시성 테스트

> **JUnit 자동화 테스트 (`ExtensionServiceConcurrencyTest`)로 검증됩니다.**

| # | 테스트 항목 | 예상 결과 | JUnit |
|---|------------|----------|-------|
| 1 | 동시에 같은 확장자 추가 (10개 스레드) | DB에 1개만 존재, 일부는 중복 에러 | ✅ |
| 2 | 동시에 서로 다른 확장자 추가 (50개 스레드) | 모두 성공 | ✅ |
| 3 | 동시에 추가/삭제 (20개 스레드) | 데이터 정합성 유지 (0개 또는 1개) | ✅ |
| 4 | 200개 제한 동시성 테스트 (250개 시도) | 제한 초과 에러 발생 | ✅ |

### 동시성 테스트 검증 조건 설명

동시성 환경에서 race condition으로 인해 정확한 성공/실패 카운트를 예측하기 어렵습니다.
따라서 테스트는 **최종 DB 상태**에 초점을 맞춥니다:

```java
// 중요한 것은 최종 결과 - DB에 중복 없이 1개만 존재
assertThat(repository.findByFixedFalse()).hasSize(1);
assertThat(successCount.get()).isGreaterThanOrEqualTo(1);
assertThat(failCount.get()).isGreaterThan(0);
```

---

## 8. 데이터 영속성 테스트

| # | 테스트 항목 | 예상 결과 | 통과 |
|---|------------|----------|------|
| 1 | 브라우저 새로고침 | 데이터 유지 | [ ] |
| 2 | 브라우저 종료 후 재접속 | 데이터 유지 | [ ] |
| 3 | 서버 재시작 | 데이터 유지 | [ ] |
| 4 | H2 DB 파일 존재 확인 | `backend/data/extensions.mv.db` 생성됨 | [ ] |

---

## 9. 에러 복구 테스트

| # | 테스트 항목 | 예상 결과 | 통과 |
|---|------------|----------|------|
| 1 | 서버 다운 상태에서 추가 시도 | 에러 메시지 표시 | [ ] |
| 2 | 네트워크 끊김 상태 | 에러 메시지 표시 | [ ] |
| 3 | 에러 후 재시도 | 정상 동작 | [ ] |

---

## 테스트 결과 요약

| 카테고리 | 수동 테스트 | JUnit 자동화 | 비고 |
|---------|-----------|-------------|------|
| 기능 테스트 | 13 | 31 | ExtensionServiceTest |
| 입력값 검증 | 22 | 31 | ExtensionServiceTest |
| 개수 제한 | 2 | 2 | ExtensionServiceTest |
| UI/UX | 10 | - | 수동 테스트 필요 |
| API 테스트 | 10 | 14 | ExtensionControllerTest |
| 보안 테스트 | 5 | 3 | 경로 탐색 테스트 포함 |
| 동시성 | - | 4 | ExtensionServiceConcurrencyTest |
| 데이터 영속성 | 4 | - | 수동 테스트 필요 |
| 에러 복구 | 3 | - | 수동 테스트 필요 |
| **합계** | **69** | **49** | |

---

## 구현 변경 이력

### 주요 수정 사항

1. **데이터 영속성 수정**
   - `sql.init.mode: always` → `embedded`로 변경
   - 서버 재시작 시 data.sql이 데이터를 초기화하는 문제 해결

2. **Lombok 설정 추가**
   - `maven-compiler-plugin`에 annotationProcessorPaths 추가
   - IntelliJ와 Maven 빌드 간 호환성 확보

3. **DTO 수정**
   - `CustomExtensionRequest`에 `@Setter`, `@AllArgsConstructor` 추가
   - Jackson 역직렬화 오류 해결

4. **프론트엔드 입력 제한 제거**
   - `maxlength="20"` 속성 제거
   - 21자 이상 입력 시 백엔드 에러 메시지 표시 가능

5. **경로 탐색 공격 방지**
   - `/`, `\\`, `..` 패턴 감지 및 차단
   - `PATH_TRAVERSAL_DETECTED` 에러 코드 추가

6. **동시성 테스트 조건 완화**
   - 정확한 성공/실패 카운트 대신 최종 DB 상태 검증
   - Race condition 고려한 현실적인 테스트 조건

---

## 테스트 실행 정보

- **테스트 환경**: Windows 10, Java 23, Node.js 22, Chrome
- **테스트 일시**:
- **테스터**:
